const ValidationRule = require('../contracts/ValidationRule');
const ValidationResult = require('../ValidationResult');

/**
 * Validates that a field value is one of the allowed enum values
 */
class EnumRule extends ValidationRule {
  constructor(allowedValues) {
    super();
    this.allowedValues = allowedValues;
  }

  async validate(value, fieldName, data) {
    const result = new ValidationResult();

    if (value && !this.allowedValues.includes(value)) {
      result.addError(fieldName, this.getErrorMessage(fieldName, value), this.getName());
    }

    return result;
  }

  getErrorMessage(fieldName, value) {
    const allowedValuesStr = this.allowedValues.join(', ');
    return `The ${fieldName} must be one of: ${allowedValuesStr}.`;
  }

  getName() {
    return 'enum';
  }
}

module.exports = EnumRule;
