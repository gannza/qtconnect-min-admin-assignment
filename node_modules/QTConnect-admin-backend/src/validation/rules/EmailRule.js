const ValidationRule = require('../contracts/ValidationRule');
const ValidationResult = require('../ValidationResult');

/**
 * Validates that a field contains a valid email address
 */
class EmailRule extends ValidationRule {
  constructor() {
    super();
    this.emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  }

  async validate(value, fieldName, data) {
    const result = new ValidationResult();

    if (value && !this.emailRegex.test(value)) {
      result.addError(fieldName, this.getErrorMessage(fieldName, value), this.getName());
    }

    return result;
  }

  getErrorMessage(fieldName, value) {
    return `The ${fieldName} must be a valid email address.`;
  }

  getName() {
    return 'email';
  }
}

module.exports = EmailRule;
