#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "Running pre-commit checks..."

# Check if we're in a git repository
if [ ! -d ".git" ]; then
  echo "Error: Not in a git repository"
  exit 1
fi

# Function to check a directory
check_directory() {
  local dir=$1
  local dir_name=$2
  
  if [ ! -d "$dir" ]; then
    echo "Warning: $dir_name directory not found, skipping..."
    return 0
  fi
  
  echo "Checking $dir_name..."
  cd "$dir"
  
  # Check if package.json exists
  if [ ! -f "package.json" ]; then
    echo "Warning: No package.json in $dir_name, skipping..."
    cd ..
    return 0
  fi
  
  # Run lint-staged for staged files in this directory
  echo "Running lint-staged for $dir_name..."
  npx lint-staged
  
  # Run type checking if available
  if npm run typecheck >/dev/null 2>&1; then
    echo "Running type checking for $dir_name..."
    npm run typecheck
  else
    echo "No type checking script found for $dir_name, skipping..."
  fi
  
  cd ..
  echo "$dir_name checks completed"
}

# Check backend directory
check_directory "backend" "Backend"

# Check frontend directory
check_directory "frontend" "Frontend"

echo "Pre-commit checks passed!"
